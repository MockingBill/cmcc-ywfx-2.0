
<!--表格-->
<div class="row">
    <div class="col-xs-12 col-md-12">
        <div class="widget">
            <div class="widget-body">
                <div id="cc" class="easyui-layout" data-options="fit:true,border:false"
                     style="width:800px; height:580px;background-color: #fbfbfb;">
                    <div data-options="region:'center',border:false" style="overflow-x:hidden;overflow-y:hidden">
                        <div id="toolbar" class="row tbRow">
                            <div class="col-xs-10 col-md-10">
                                <form id="selectForm" class="form-inline">
                                    <div class="form-group">
                                        <div class="input-group">
                                            <span class="input-group-btn">
                                                <button class="btn btn-default" type="button" onclick="viewInterface()"><i class="glyphicon glyphicon-eye-open"></i>查看</button>
                                            </span>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="input-group">
                                            <span class="input-group-btn"><button class="btn btn-default" type="button" onclick="start()"><i class="glyphicon glyphicon-triangle-right"></i>启动</button>
                                            </span>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="input-group">
                                            <span class="input-group-btn"><button class="btn btn-default" type="button" onclick="stop()"><i class="glyphicon glyphicon-stop"></i>停止</button>
                                            </span>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="input-group">
<span class="input-group-btn">
    <button class="btn btn-default" type="button" onclick="modifyInterface()"><i
            class="glyphicon glyphicon-cog"></i>修改</button>
                                            </span>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="input-group">
<span class="input-group-btn">
    <button class="btn btn-default" type="button" onclick="addInterface()"><i
            class="glyphicon glyphicon-plus"></i>新增</button>
                                            </span>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="input-group">
<span class="input-group-btn">
    <button class="btn btn-default" type="button" onclick="del()"><i
            class="glyphicon glyphicon-trash"></i>删除</button>
                                            </span>
                                        </div>
                                    </div>

                                </form>
                            </div>
                            <div class="col-xs-2 col-md-2 text-right">
                                <form id="searchFrom" class="form-inline">
                                    <div class="form-group">
                                        <div class="input-group">
                                            <span class="input-group-btn">
                                                <button class="btn btn-default" type="button" onclick="doSearch()"><i
                                                        class="fa fa-search"></i>查询</button>
                                            </span>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                        <!--主显示页面 easyUI dataGrid-->
                        <table id="simpledatatable"></table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!--表格-->

<!--查看-->
<div class="mydialog">
    <div id="viewPanle">
        <div class="row">
            <div class="col-md-12">
                <form id="interViewForm" class="form-horizontal form-bordered" role="form"
                      enctype="multipart/form-data">
                    <div class="form-group" style="margin-top: 20px">
                        <label for="inputNo" class="col-sm-1 control-label no-padding-right">接口名称</label>
                        <div class="col-sm-5">
                            <div class="input-group" style="width: 340px">
                                <input type="text" class="easyui-validatebox form-control" readonly="true" name="in_name"
                                       id="in_name1">
                            </div>
                        </div>
                        <label for="inputName"
                               class="col-sm-1  control-label no-padding-right">接口状态</label>
                        <div class="col-sm-5">
                            <div class="input-group" style="width: 340px">
                                <input type="text" class="easyui-validatebox form-control" readonly="true" name="in_statsus" id="in_statsus1">
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="inputMobile"
                               class="col-md-1 control-label no-padding-right">接口地址</label>
                        <div class="col-md-5">
                            <div class="input-group" style="width: 340px">
                                <input type="text" class="easyui-validatebox form-control" readonly="true" name="in_host"
                                       id="in_host1">
                            </div>
                        </div>
                        <label for="inputName"
                               class="col-md-1 control-label no-padding-right">接口端口</label>
                        <div class="col-md-5">
                            <div class="input-group" style="width: 340px">
                                <input type="text" class="easyui-validatebox form-control" readonly="true" name="in_port"
                                       id="in_port1">
                            </div>
                        </div>
                    </div>


                    <div class="form-group">
                        <label for="inputAge"
                               class="col-md-1 control-label no-padding-right">接口路径</label>
                        <div class="col-md-5">
                            <div class="input-group" style="width: 340px">
                                <input type="text" class="easyui-validatebox form-control" readonly="true" name="in_url"
                                       id="in_url1">
                            </div>
                        </div>

                        <label for="inputStatus"
                               class="col-md-1 control-label no-padding-right">请求方法</label>
                        <div class="col-md-5">
                            <div class="input-group" style="width: 340px">
                                <input type="text" class="easyui-validatebox form-control" readonly="true" name="in_method" id="in_method1">
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="inputStatus"
                               class="col-md-1 control-label no-padding-right">请求体</label>
                        <div class="col-md-5">
                            <div class="input-group">
                                <textarea readonly="true" id="in_body1" name="in_body" style="width: 341px;height: 65px"></textarea>
                            </div>
                        </div>
                        <label for="inputStatus"
                               class="col-md-1 control-label no-padding-right">请求头</label>
                        <div class="col-md-5">
                            <div class="input-group">
                                <textarea readonly="true" id="in_headers1" name="in_headers" style="width: 341px;height: 65px"></textarea>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="inputName"
                               class="col-md-1 control-label no-padding-right">出参存表</label>
                        <div class="col-md-5">
                            <div class="input-group" style="width: 340px">
                                <input type="text" class="easyui-validatebox form-control" readonly="true" name="in_outTable"
                                       id="in_outTable1">
                            </div>
                        </div>
                        <label for="inputName"
                               class="col-md-1 control-label no-padding-right">内容类型</label>
                        <div class="col-md-5">
                            <div class="input-group" style="width: 340px">
                                <input type="text" class="easyui-validatebox form-control" readonly="true" name="in_content_type" id="in_content_type1">
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="inputName"
                               class="col-md-1 control-label no-padding-right">结束位置</label>
                        <div class="col-md-5">
                            <div class="input-group" style="width: 340px">
                                <input type="text" class="easyui-validatebox form-control" readonly="true" name="in_stopPoint"
                                       id="in_stopPoint1">
                            </div>
                        </div>
                        <label for="inputName"
                               class="col-md-1 control-label no-padding-right">执行间隔</label>
                        <div class="col-md-5">
                            <div class="input-group" style="width: 340px">
                                <input type="text" class="easyui-validatebox form-control" readonly="true" name="in_execTime" id="in_execTime1">
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<!--查看-->

<!--新增修改-->
<div class="mydialog">
    <div id="updatePanle">
        <div class="row">
            <div class="col-md-12">
                <form id="interUpdateForm" class="form-horizontal form-bordered" role="form"
                      enctype="multipart/form-data">
                    <div class="form-group" style="margin-top: 20px">
                        <label for="inputNo" class="col-sm-1 control-label no-padding-right">接口名称</label>
                        <div class="col-sm-5">
                            <div class="input-group" style="width: 340px">
                                <input type="text" class="easyui-validatebox form-control"  name="in_name"
                                       id="in_name">
                            </div>
                        </div>
                        <label for="inputName"
                               class="col-sm-1  control-label no-padding-right">接口状态</label>
                        <div class="col-sm-5">
                            <div class="input-group" style="width: 340px">
                                <input type="text" class="easyui-validatebox form-control"  name="in_statsus" id="in_statsus">
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="inputMobile"
                               class="col-md-1 control-label no-padding-right">接口地址</label>
                        <div class="col-md-5">
                            <div class="input-group" style="width: 340px">
                                <input type="text" class="easyui-validatebox form-control"  name="in_host"
                                       id="in_host">
                            </div>
                        </div>
                        <label for="inputName"
                               class="col-md-1 control-label no-padding-right">接口端口</label>
                        <div class="col-md-5">
                            <div class="input-group" style="width: 340px">
                                <input type="text" class="easyui-validatebox form-control"  name="in_port"
                                       id="in_port">
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="inputAge"
                               class="col-md-1 control-label no-padding-right">接口路径</label>
                        <div class="col-md-5">
                            <div class="input-group" style="width: 340px">
                                <input type="text" class="easyui-validatebox form-control"  name="in_url"
                                       id="in_url">
                            </div>
                        </div>
                        <label for="inputStatus"
                               class="col-md-1 control-label no-padding-right">请求方法</label>
                        <div class="col-md-5">
                            <div class="input-group" style="width: 340px">
                                <input type="text" class="easyui-validatebox form-control"  name="in_method" id="in_method">
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="inputStatus"
                               class="col-md-1 control-label no-padding-right">请求体</label>
                        <div class="col-md-5">
                            <div class="input-group">
                                <textarea  id="in_body" name="in_body" style="width: 341px;height: 65px"></textarea>
                            </div>
                        </div>
                        <label for="inputStatus"
                               class="col-md-1 control-label no-padding-right">请求头</label>
                        <div class="col-md-5">
                            <div class="input-group">
                                <textarea  id="in_headers" name="in_headers" style="width: 341px;height: 65px"></textarea>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="inputName"
                               class="col-md-1 control-label no-padding-right">出参存表</label>
                        <div class="col-md-5">
                            <div class="input-group" style="width: 340px">
                                <input type="text" class="easyui-validatebox form-control"  name="in_outTable"
                                       id="in_outTable">
                            </div>
                        </div>
                        <label for="inputName"
                               class="col-md-1 control-label no-padding-right">内容类型</label>
                        <div class="col-md-5">
                            <div class="input-group" style="width: 340px">
                                <input type="text" class="easyui-validatebox form-control"  name="in_content_type" id="in_content_type">
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="inputName"
                               class="col-md-1 control-label no-padding-right">结束位置</label>
                        <div class="col-md-5">
                            <div class="input-group" style="width: 340px">
                                <input type="text" class="easyui-validatebox form-control"  name="in_stopPoint"
                                       id="in_stopPoint">
                            </div>
                        </div>
                        <label for="inputName"
                               class="col-md-1 control-label no-padding-right">执行间隔</label>
                        <div class="col-md-5">
                            <div class="input-group" style="width: 340px">
                                <input type="text" class="easyui-validatebox form-control"  name="in_execTime" id="in_execTime">
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<!--新增修改-->

<script>
    $(document).ready(function () {
        loadTable();
    });
    
    function viewInterface() {
        var rows=$('#simpledatatable').datagrid('getSelected');
        if((typeof rows.in_body)=='object'&&(typeof rows.in_headers)=='object'){
            rows.in_body=JSON.stringify(rows.in_body);
            rows.in_headers=JSON.stringify(rows.in_headers);
        }
        $('#interViewForm').form('load',rows);
        $('#viewPanle').dialog({
            title: "查看接口",
            autoOpen: false,
            width: 1000,
            height: 550,
            top: 50,
            modal: true,
            buttons: [
                {
                    text: '关闭',
                    handler: function () {
                        $('#interViewForm').form('clear');
                        $('#viewPanle').dialog('close');
                    }
                }
            ]
        });
    }
    
    function modifyInterface() {
        var rows=$('#simpledatatable').datagrid('getSelected');
        if((typeof rows.in_body)=='object'&&(typeof rows.in_headers)=='object'){
            rows.in_body=JSON.stringify(rows.in_body);
            rows.in_headers=JSON.stringify(rows.in_headers);
        }
        $('#interUpdateForm').form('load',rows);
        $('#updatePanle').dialog({
            title: "修改接口",
            autoOpen: false,
            width: 1000,
            height: 550,
            top: 50,
            modal: true,
            buttons: [
                {   text: '确定',
                    handler: function () {
                        update(rows._id);
                        $('#interUpdateForm').form('clear');
                        $('#updatePanle').dialog('close');
                        $('#simpledatatable').datagrid('reload',{});
                    }
                },
                {
                    text: '关闭',
                    handler: function () {
                        $('#interUpdateForm').form('clear');
                        $('#updatePanle').dialog('close');
                        $('#simpledatatable').datagrid('reload',{});
                    }
                }
            ]
        });
    }
    function addInterface() {
        var data=$('#simpledatatable').datagrid('getData');
        $("#in_body").val(JSON.stringify(data.rows[0].in_body));
        $("#in_headers").val(JSON.stringify(data.rows[0].in_headers));
        $('#updatePanle').dialog({
            title: "新增接口",
            autoOpen: false,
            width: 1000,
            height: 550,
            top: 50,
            modal: true,
            buttons: [
                {
                    text: '确定',
                    handler: function () {
                        add();
                        $('#interUpdateForm').form('clear');
                        $('#updatePanle').dialog('close');
                        $('#simpledatatable').datagrid('reload',{});
                    }
                },
                {
                    text: '关闭',
                    handler: function () {
                        $('#interUpdateForm').form('clear');
                        $('#updatePanle').dialog('close');
                        $('#simpledatatable').datagrid('reload',{});
                    }
                }
            ]
        });
    }
    
    function update(id) {
        var formData = $('#interUpdateForm').serializeArray();

        $.ajax({
            type:'PUT',
            url: '{{projcfg.appurl}}/api/migu/migu_route/'+id,
            data: formData,
            success: function (retdata) {

                if(retdata.success)
                    msgSuccess(retdata.msg);
                else
                    msgError(retdata.msg);
            }
        });

    }
    
    function add() {

        var formData = $('#interUpdateForm').serializeArray();
        $.ajax({
            type:'POST',
            url: '{{projcfg.appurl}}/api/migu/migu_route/',
            data: formData,
            success: function (retdata) {
                if(retdata.success)
                    msgSuccess(retdata.msg);
                else
                    msgError(retdata.msg);
            }
        });



    }
    
    function del() {
        var rows=$('#simpledatatable').datagrid('getSelected');
        $.messager.confirm('Confirm','是否确认的要删除该接口?',function(r){
            if (r){
                $.ajax({
                    type:'DELETE',
                    url: '{{projcfg.appurl}}/api/migu/migu_route/'+rows._id,
                    success: function (retdata) {
                        if(retdata.success){
                            msgSuccess(retdata.msg);
                            $('#simpledatatable').datagrid('reload',{});
                        }

                        else{
                            msgError(retdata.msg);
                            $('#simpledatatable').datagrid('reload',{});
                        }

                    }
                });
            }
        });
        
    }

    function start() {
        var rows=$('#simpledatatable').datagrid('getSelected');
        $.ajax({
            type:'get',
            url: '{{projcfg.appurl}}/api/migu/migu_route/exec/'+rows._id,
            success: function (retdata) {
                if(retdata.success){
                    msgSuccess(retdata.msg);
                    $('#simpledatatable').datagrid('reload',{});
                }

                else{
                    msgError(retdata.msg);
                    $('#simpledatatable').datagrid('reload',{});
                }

            }
        });
    }

    function stop() {
        var rows=$('#simpledatatable').datagrid('getSelected');
        $.ajax({
            type:'get',
            url: '{{projcfg.appurl}}/api/migu/migu_route/stop/'+rows._id,
            success: function (retdata) {
                if(retdata.success){
                    msgSuccess(retdata.msg);
                    $('#simpledatatable').datagrid('reload',{});
                }

                else{
                    msgError(retdata.msg);
                    $('#simpledatatable').datagrid('reload',{});
                }

            }
        });
    }
    

    function loadTable() {
        //数据表格加载
        $('#simpledatatable').datagrid({
            url: '{{projcfg.appurl}}/api/migu/migu_route/listInterFace',
            method: 'get',
            title: "接口列表",
            height: 500,
            striped: true,
            queryParams: {},
            fitColumns: false,
            border: true,
            singleSelect: true,
            selectOnCheck: false,
            columns: [[
                {field: '_id', checkbox: true},
                {"field": "sys_id", "title": "所属系统", "width": 250},
                {"field": "in_name", "title": "接口名", "width": 200},
                {"field": "in_statsus", "title": "工作状态", "width": 100},
                {"field": "in_outTable", "title": "出参存表", "width": 100},
                {"field": "in_stopPoint", "title": "停止位置", "width": 150},
                {"field": "in_content_type", "title": "接口类型", "width": 150},
                {
                    "field": "in_execTime", "title": "执行间隔", "width": 172, "formatter":
                            function (value, row, index) {
                                if (Number(value) < 60)
                                    return (Number(value)) + "分钟";
                                else if (Number(value) >= 60 && Number(value) < 1440)
                                    return (Number(value) / 60).toFixed(2) + "小时";
                                else
                                    return (Number(value) / 1440).toFixed(2) + "天";
                            }
                }

            ]],
            onLoadSuccess: function (json) {
                if (!json.success) {
                    msgError(json.msg);
                }
            },
            onLoadError: function () {
                msgError('加载数据出现时发生错误,请稍候重试...');
            },
            pagination: true,
            loadMsg: '正在加载...'
        });
        var role_code = '{{currentUserRole.role_code}}';
        var org_code = '{{currentUser.user_org.org_code}}';
        var login_account = '{{currentUser.login_account}}';

        if (org_code != "000102" && login_account != "yangruofan") {
            if (role_code == "001" || role_code == "sysadmin" || role_code == "002" || role_code == "005" || role_code == "007") {
                $('#org_codeSelectDiv').show();
            } else {
                $('#org_codeSelectDiv').hide();
                $('#activeCss').css({
                    "margin-left": "150px"
                });
            }
        } else {
            $('#org_codeSelectDiv').show();
        }

    };

</script>

